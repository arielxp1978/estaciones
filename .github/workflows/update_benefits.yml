name: Actualizar Beneficios Estaciones

on:
  schedule:
    # Se ejecuta el día 3 de cada mes a las 00:00 UTC
    - cron: '0 0 3 * *'
  workflow_dispatch: # Permite ejecución manual desde la web de GitHub

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repositorio
      uses: actions/checkout@v3

    - name: Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Instalar dependencias
      run: |
        python -m pip install --upgrade pip
        pip install supabase playwright
        # Si usas playwright para el scraping real:
        # python -m playwright install chromium

    - name: Ejecutar Script de Actualización
      env:
        SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
        SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
      run: python scripts/cloud_updater.py

    - name: Commitear cambios locales (JSON de auditoría)
      run: |
        git config --global user.name 'GitHub Action'
        git config --global user.email 'action@github.com'
        git add scripts/ultimo_relevamiento.json
        git commit -m "Auto-update: relevamiento $(date +%Y-%m)" || exit 0
        git push
