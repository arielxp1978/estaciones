# Guía de Configuración Final: Automatización en la Nube

Para que el sistema funcione automáticamente y guarde los datos en la nube, sigue estos pasos:

## 1. Configurar Supabase (Base de Datos)
1. Crea una cuenta gratuita en [Supabase](https://supabase.com/).
2. Crea un nuevo proyecto.
3. En el **SQL Editor**, ejecuta lo siguiente para crear la tabla (o usa `drop table beneficios;` si quieres borrarla y empezar de cero):
   ```sql
   -- Tabla de beneficios individuales
   create table if not exists beneficios (
     id bigint generated by default as identity primary key,
     created_at timestamptz default now(),
     estacion text,
     banco text,
     medio_pago text,
     dia text,
     combustible text,
     descuento int,
     tope int,
     vigencia date
   );

   -- Tabla de análisis pre-procesado por IA
   create table if not exists analisis_ia (
     id bigint generated by default as identity primary key,
     tipo text, -- ej: "nafta super", "diesel", "general"
     localidad text default 'todo el país',
     contenido text, -- Resumen en markdown generado
     fecha_actualizacion timestamptz default now()
   );
   ```
4. Ve a **Project Settings > API** y copia la `URL` y la `service_role key` (o `anon key` si habilitas RLS).

## 2. Configurar GitHub (Automatización)
Para que GitHub vea los archivos que hemos creado localmente, abre una terminal en la carpeta `Estaciones` de tu Mac y ejecuta estos comandos **uno por uno** (no copies las líneas con ` ```bash ` o ` ``` `):

> [!IMPORTANT]
> Copia solo el texto de la línea, sin las comillas ni los símbolos de código.

```bash
git remote add origin https://github.com/arielxp1978/estaciones.git
git add .
git commit -m "Configuración inicial de beneficios y automatización"
git branch -M main
git push -u origin main
```

> [!WARNING]
> **Si GitHub te pide contraseña y falla:** GitHub ya no acepta tu contraseña normal en la terminal. Debes usar un **Personal Access Token (PAT)**:
> 1. Ve a tu GitHub en la web > **Settings** (tu perfil) > **Developer Settings** > **Personal Access Tokens** > **Tokens (classic)**.
> 2. Dale clic a **Generate new token (classic)**, ponle un nombre y marca las casillas **repo** Y **workflow** (esta última es obligatoria para poder subir el archivo de automatización).
> 3. Genera el token y **cópialo**. Usa ese código larguísimo como tu "Password" en la terminal cuando te lo pida.

Una vez ejecutado esto, la pestaña **Actions** se actualizará y verás el script.

Luego, en GitHub, ve a **Settings > Secrets and variables > Actions** del repositorio:
3. Crea dos "Repository secrets":
   - `SUPABASE_URL`: Pega la URL de tu proyecto.
   - `SUPABASE_KEY`: Pega la clave API de tu proyecto.

## 3. Funcionamiento
- El sistema se ejecutará solo el **día 3 de cada mes**.
- Si quieres probarlo ahora, ve a la pestaña **Actions** en GitHub, selecciona "Actualizar Beneficios Estaciones" y haz clic en **Run workflow**.

---
*Cualquier sistema externo podrá ahora consultar tu base de datos mediante la API REST de Supabase o directamente conectándose a PostgreSQL.*
